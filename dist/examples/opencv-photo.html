<!DOCTYPE html>
<html>
    <head>
        <title>OpenCV Photo Example</title>
        <script src="https://cdn.babylonjs.com/babylon.js"></script>
        <script src="../babylonAr.js"></script>
    </head>
    <body>
        <canvas id="renderCanvas" width="1024" height="768"></canvas>
        <script>
            window.addEventListener("DOMContentLoaded", function () {
                var canvas = document.getElementById('renderCanvas');
                var engine = new BABYLON.Engine(canvas, true);
    
                var createScene = async function () {
                    var scene = new BABYLON.Scene(engine);
                    var camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, 5, -10), scene);
                    camera.setTarget(BABYLON.Vector3.Zero());
                    camera.attachControl(canvas, false);
                    var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0,1,0), scene);
                    var ground = BABYLON.Mesh.CreateGround('ground1', 6, 6, 2, scene);

                    var marred = new BABYLON.Texture("opencv-photo-resources/babylon_logo_marred.png");
                    var mask = new BABYLON.Texture("opencv-photo-resources/babylon_logo_mask.png");

                    await BabylonAR.OpenCVPhoto.InitializeAsync();
                    var texture = await BabylonAR.OpenCVPhoto.InpaintAsync(marred, mask, scene, 5);
                    console.log(texture.readPixels());

                    var healedMaterial = new BABYLON.StandardMaterial("healedMaterial", scene);
                    healedMaterial.diffuseTexture = texture;
                    ground.material = healedMaterial;

                    return scene;
                }

                createScene().then(function (scene) {
                    engine.runRenderLoop(function(){
                        scene.render();
                    });
                    window.addEventListener('resize', function(){
                        engine.resize();
                    });
                });
            });
        </script>
    </body>
</html>